---
typora-root-url: ./
---

# 1-卷积

## 1. 一个图像去噪的想法

对于一个带噪声的图像，一个直观的想法是：对于每个点，将其像素值变为其周围值的平均值来削弱噪声。

## 2. 卷积

设 $f$ 为图像矩阵，$g$ 为卷积核，则 $f$ 和 $g$ 的卷积可以定义为
$$
f*g[m,n]=\sum_{k,l}{f[m-k,n-l]g[k,l]}
$$
其中 $(m,n)$ 为图像中当前点的坐标。

当取 $3*3$ 的卷积核时，$k, l$ 的定义域为 $\left\{-1, 0, 1 \right\}$。

直观来看，对于一个卷积核，我们必须将其**左右、上下翻转**之后才能应用于图像中。

## 3. 卷积的性质

1. **线性性（Linearity）**：$\text{filter}(f_1+f_2) = \text{filter}(f_1) + \text{filter}(f_2)$

2. **平移不变性（Shift invariance）**：$\text{filter}(\text{shift}(f)) = \text{shift}(\text{filter}(f))$

   这个性质的直观理解为：先平移后卷积的效果和先卷积后平移的效果相同。

3. **交换律**：$a*b=b*a$

4. **结合律**：$a*(b*c)=(a*b)*c$

   例如：$((a*b_1)*b_2)*b_3=a*(b_1*b_2*b_3)$

5. **分配律**：$a*(b+c)=(a*b)+(a*c)$

6. **数乘**：$ka*b=a*kb=k(a*b)$

7. **脉冲矩阵**：$e=[\dots, 0, 0, 1, 0, 0, \dots]$，则有 $a*e=a$

## 4. 边界填充方法

目的：input 和 output 有相同大小

1. 边缘全部填充 $0$

   ![1-4-1](/Figures/1/1-4-1.jpg)

2. wrap around

   ![1-4-2](/Figures/1/1-4-2.jpg)

   ![1-4-3](/Figures/1/1-4-3.jpg)

3. copy edge

   ![1-4-4](/Figures/1/1-4-4.jpg)

   ![1-4-5](/Figures/1/1-4-5.jpg)

4. reflect across edge

   ![1-4-6](/Figures/1/1-4-6.jpg)

   ![1-4-7](/Figures/1/1-4-7.jpg)

## 5. 卷积应用

### 5.1 卷积后得到原图

![5-1](/Figures/1/5-1.jpg)

### 5.2 向左平移一个单位长度

![5-2](/Figures/1/5-2.jpg)

### 5.3 均值滤波

拉近当前点的像素值与相邻点的像素值，即**平滑**或**模糊**操作。

![5-3](/Figures/1/5-3.jpg)

可直观理解为：边缘的像素值一般比较突兀，进行均值计算之后，就将边缘的像素值跟相邻的像素值进行中和了。

### 5.4 锐化

![5-4](/Figures/1/5-4.jpg)

![5-4-2](/Figures/1/5-4-2.jpg)

上述操作可以分解为两个操作：

1. **边缘的获取**：对图像进行平滑操作，边缘部分的变化较大，其他部分变化较不明显，因此将原图像与平滑后的图像做差之后就得到了图像的边缘信息。
2. 原图加上边缘之后便完成了锐化操作。

设原图像为 $I$，
$$
e=
\left[
\begin{matrix}
0 & 0 & 0 \\
0 & 1 & 0 \\
0 & 0 & 0
\end{matrix}
\right]
$$

$$
g=\frac{1}{9}
\left[
\begin{matrix}
1 & 1 & 1 \\
1 & 1 & 1 \\
1 & 1 & 1
\end{matrix}
\right]
$$

则边缘获取可表示为
$$
I*e-I*g=I*(e-g)
$$
于是就有了整个过程
$$
I*(e-g)+I*e=I*(2e-g)
$$

## 6. 高斯滤波

### 6.1 振铃现象

![6-1-1](/Figures/1/6-1-1.jpg)

如果执行了均值滤波，因为模板是方的，就会产生振铃现象，会出现纵横纹理。

可采用**高斯滤波**来解决。

距离越近贡献越大，距离越远贡献越小。

### 6.2 高斯模板

可使用二维高斯函数
$$
G_{\sigma}=\frac{1}{2\pi\sigma^2}e^{-\frac{x^2+y^2}{2\sigma^2}}
$$
![6-1-2](/Figures/1/6-1-2.jpg)

必须保证模板中所有权重加和为 $1$，否则会发生异常，举例如下：

若
$$
I=
\left[
\begin{matrix}
255 & 255 & 255 \\
255 & 255 & 255 \\
255 & 255 & 255
\end{matrix}
\right]
$$
如果采用了权重和不为 $1$ 的模板，则会发生周围点都是 $255$ 却被衰减的现象，这显然是不符合常理的。

因此我们必须对模板进行归一化，归一化的方法如下：
$$
\frac{g_{i,j}}{\sum_{a,b}g_{a, b}}
$$

### 6.3 高斯核方差 $\sigma$ 对高斯滤波的影响

![6-3-1](/Figures/1/6-3-1.jpg)

当窗宽 $m$ 固定时，因为总面积等于 $1$，所以 $\sigma$ 越小，则**中心（自己）所占的比重**就会越大，滤波效果**越不明显**；否则就会越小，滤波效果就会**更加明显**。

### 6.4 窗宽 $m$ 对高斯滤波的影响

![6-4-1](/Figures/1/6-4-1.jpg)

我们**固定高斯核方差** $\sigma$，显然对应点的 $G_{\sigma}$ **不变**，但是由于**归一化操作（Normalization）**，当窗宽 $m$ **增大**时，**中心点（自己）的比重**就会**变小**，所以此时高斯滤波的效果就会更加**明显**。

### 6.5 $\sigma$ 和 $m$ 的关系

![6-5-1](/Figures/1/6-5-1.jpg)

一般设置 $m = 6\sigma+1$，即两边的宽度均为 $3\sigma$，这样就保证了 $\sum a_{i,j} = 0.99\dots$，从而省去了归一化的操作。

### 6.6 高斯核的本质和性质

1. 高斯滤波是**低通滤波**。
2. **高频信号**相当于**变化比较剧烈**的像素点。
3. 一次 $\sigma_1$ 的高斯滤波和一次 $\sigma_2$ 的高斯滤波相当于**一次** $\sqrt{\sigma_1^2+\sigma_2^2}$ **的高斯滤波**，满足勾股定理。

### 6.7 高斯核的分解

![6-7-1](/Figures/1/6-7-1.jpg)

这样可以**降低时间复杂度**：

1. 对于一次高斯滤波，若窗宽为 $m$，则**时间复杂度**为 $O(m^2)$；
2. 若采用**分解之后**的高斯核进行一次高斯滤波，则**时间复杂度**为 $O(m)$；
3. **总的时间复杂度**为 $O(n^2m)$。

## 7. 去噪

### 7.1 常见噪声

![7-1-1](/Figures/1/7-1-1.jpg)

椒盐噪声、白噪声、高斯噪声

### 7.2 高斯噪声的产生

![7-2-1](/Figures/1/7-2-1.jpg)

1. 理想图 + 高斯噪声（光学因素、采集器、...） -> 实际的图。
2. 该模型的建模只针对方差较小的场合，假设噪声来源于独立的正态分布，$\mu=0$。

### 7.3 利用高斯滤波来去除高斯噪声

![7-3-1](/Figures/1/7-3-1.jpg)

高斯噪声的 $\sigma$ 越大，就需要选择 $\sigma$ 更大的高斯模板。

### 7.4 中值滤波去除椒盐噪声

![7-4-1](/Figures/1/7-4-1.jpg)![7-4-2](/Figures/1/7-4-2.jpg)

1. 中值滤波**不是线性滤波**。
2. 中值滤波**不会产生新的像素值**，而均值滤波会将噪声与其他点进行**中和**，并不能彻底消除噪声。
3. 中值滤波对 outliers（异常点，In statistics, an outlier is a data point that differs significantly from other observations.）鲁棒性较强。

## 8. 锐化

![8](/Figures/1/8.jpg)